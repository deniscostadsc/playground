---
name: Lint
on: [push]
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Get changed files
        id: changed-files
        run: echo "changed_files=$(git diff --name-only ${{ github.event.before }} ${{ github.event.after }} | xargs)" >> $GITHUB_OUTPUT
      - name: Check if wrong files have a error description
        run: make check-wrongs CHANGED_FILES="${{ steps.changed-files.outputs.changed_files }}"
      - name: Check if tags are correct
        run: make check-tags
      - name: Determine lint scope
        id: lint-scope
        run: |
          ./scripts/lint/determine-lint-scope.sh ${{ github.event.before }} ${{ github.event.after }} || echo "lints=" >> $GITHUB_OUTPUT
      - uses: docker/setup-buildx-action@v2
      - name: Run linters
        run: |
          if [[ -n "${{ steps.lint-scope.outputs.lints }}" ]]; then
            make lint LINTS="${{ steps.lint-scope.outputs.lints }}"
          else
            make lint
          fi
