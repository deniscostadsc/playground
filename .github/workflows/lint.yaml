---
name: Lint
on: [push]
jobs:
  lint:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Download previous failed files
        uses: dawidd6/action-download-artifact@v6
        with:
          workflow: Lint
          workflow_search: true
          workflow_conclusion: success
          name: failing-changed-files-for-lint
          path: ./
          if_no_artifact_found: ignore
      - name: Determine lint scope
        id: lint-scope
        run: |
          ./scripts/lint/determine-lint-scope.sh ${{ github.event.before }} ${{ github.event.after }} || echo "lints=" >> $GITHUB_OUTPUT
      - name: Upload current files to check
        uses: actions/upload-artifact@v4
        with:
          name: failing-changed-files-for-lint
          path: all-files-to-check.txt
          retention-days: 7
      - name: Run linters
        id: run-linters
        run: |
          if [[ -n "${{ steps.lint-scope.outputs.lints }}" ]]; then
            make lint LINTS="${{ steps.lint-scope.outputs.lints }}"
          else
            make lint
          fi
      - name: Check if wrong files have a error description
        run: make check-wrongs
      - name: Check if tags are correct
        run: make check-tags
      - name: Create empty file
        run: |
          echo "" > empty-failed-files.txt
      - name: Upload success (empty file)
        uses: actions/upload-artifact@v4
        with:
          name: failing-changed-files-for-lint
          path: empty-failed-files.txt
          retention-days: 7
          overwrite: true
